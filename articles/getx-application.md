---
title: "GetXの運用が辛くなったので乗り換え始めた話"
emoji: "🚀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Flutter", "GetX"]
published: false
---

# GetXについて
私がいま開発に携わっているアプリはFlutterで開発をしているのですが、特にアプリの根幹となる部分をGetXというパッケージに大きく依存しています。
GetXは主に状態管理の文脈において選択肢の一つとして挙がってくるパッケージの一つですが、状態管理に限らず非常に多くの機能を提供してくれています。
特に大きなものとして「状態管理、DI管理、ルーティング管理」の3つが挙げられます。
※これ以外にも、例えば  `isBlank` や `isEmail` などの便利関数や、localeを使った多言語対応、keyValueストアの管理なども提供してくれています。

GetXはFlutter初学者がとっつきにくいであろうBuildContextを上手く隠蔽してくれたり（GetXを使っているとcontextにアクセスすることが基本的にはなくなります）、簡単にDIできるので単純な処理はテストが書きやすくなるなど、知見が少ない中では恩恵を多分に受けることができるパッケージと言えます。
実際に、私のチームでもFlutter経験者（およびアプリ開発経験者）が全くいなかったため、そのメリットを考慮して状態管理のパッケージとしてGetXを選択したという背景があります。
おおよそ3年前となる選定当時は今ほどriverpodが成熟していなく、providerが主流ではあったものの、まだまだライブラリ選定のデファクト的な選択肢が確立されていなかったという背景もありました（確かな情報ではないですがそういう印象がありました）

そんなGetXを使って開発を進めてきたのですが、機能拡充にあたってやりづらいと感じる点が多くなってきたので、やむなく他パッケージへの乗り換えに至ることになりました。

# 乗り換えに至った理由や経緯
GetXを使っていて扱いづらいと感じた点は以下の3点です。
1. DIの管理が難しい
2. グローバルなステートにおけるRxの扱いが難しい
3. GetX自体のメンテ頻度が低い

一つずつ具体的にお話しできればと思います。

## 1. DIの管理が難しい
GetXのDIは `Get.put()` で依存性の注入を行い、 `Get.find()` で注入されたクラスインスタンスの取得を行うというシンプルなものになっています。
アプリケーションがシンプルで、DIしたいクラスが少なかった頃はよかったのですが、アプリケーションが複雑になってグローバルなステートを管理することが増えるようになるにつれて、問題が顕在化するようになりました。
具体的には、依存注入のし忘れによるバグ（ `Get.put()` のし忘れで `Get.find()` が失敗する）が多発するようにりました。
GetXでDIを管理する場合、手動で依存注入をする必要があるので、厳密なアプリケーションの設計が実は必要だったということが原因です。依存元の処理がどの処理に依存しているのか把握しやすいように実装しないと容易に壊れてしまいます。

## 2. グローバルなステートにおけるRxの扱いが難しい
GetXはRxをベースとしたパッケージです。
変数に更新があるかどうかをUI上でもそうでなくても簡単に監視ができるようになっているのですが、変数がどこで使われているのかが非常に読みづらいなと感じます。
特にグローバルなステートについてはどこで使われているかが読みづらく、気軽に修正すると気付かぬうちに全然関係のない箇所が壊れるという変更に弱い設計になってしまっていました。
こちらも依存関係が明確になるような厳密なアプリケーション設計が必要だったのですが、上手く運用できていませんでした。

## 3. GetX自体のメンテ頻度が低い
GetXの最終リリース日は `2023年9月8日` です。
機能のアップデートがないだけならまだよいのですが、不具合修正もされないので非常に困った状況にあります。
GetXを起因とした不具合がいくつかあるのですが、何ヶ月も修正できていない形になってしまっています。簡単には乗り換えができないし、自力での修正も難しいのでライブラリ選定の重要さを痛感しました。
ref: https://github.com/jonataslaw/getx/issues/3112

# 今後について
まずは移行がしやすい状態管理の実装をriverpodで置き換える予定です。GetXでの反省を活かし、導入前からアプリケーションの設計を行って慎重に移行作業を進めています。
状態管理以外にもGetXに依存している箇所が多くあるので少しずつ移行を進めていく予定です。
riverpodの選定に至った理由や移行後のアプリケーション設計についてはまた後日文書化したいと思います。
